<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ 'Editar' if categoria else 'Criar' }} Categoria | Sistema Padaria</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='categoria_form.css') }}">
</head>
<body data-theme="light">
  
  <!-- Botão de troca de tema -->
  <button class="theme-toggle" id="themeToggle">
    <i class="fas fa-moon"></i>
  </button>

  <main class="container">

    <!-- Header -->
    <header class="page-header animated-element">
      <div class="header-icon">
        <i class="fas {{ 'fa-edit' if categoria else 'fa-plus-circle' }}"></i>
      </div>
      <h1>{{ 'Editar' if categoria else 'Criar' }} Categoria</h1>
      <p class="subtitle">
        {{ 'Edite os dados da categoria' if categoria else 'Adicione uma nova categoria para organizar seus produtos' }}
      </p>

      {% if categoria %}
      <button type="button" class="btn btn-danger delete-btn" onclick="confirmDelete()">
        <i class="fas fa-trash"></i> Excluir
      </button>
      {% endif %}
    </header>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash flash-{{ category }} animated-element">
              <i class="fas fa-{% if category == 'success' %}check-circle{% else %}exclamation-circle{% endif %}"></i>
              <span>{{ message }}</span>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Form -->
    <section class="form-container animated-element">
      <form action="{{ url_for('main.create_categoria') if not categoria else url_for('main.edit_categoria', id=categoria.id) }}" method="POST" id="categoryForm">
        
        <div class="form-group">
          <label for="nome"><i class="fas fa-tag"></i> Nome *</label>
          <input type="text" id="nome" name="nome" required maxlength="50"
                 placeholder="Ex: Bebidas, Doces, Salgados"
                 value="{{ categoria.nome if categoria }}">
          <small class="form-hint">Máximo 50 caracteres</small>
        </div>

        <div class="form-group">
          <label for="descricao"><i class="fas fa-align-left"></i> Descrição</label>
          <textarea id="descricao" name="descricao" rows="4" maxlength="200"
                    placeholder="Descreva brevemente esta categoria (opcional)">{{ categoria.descricao if categoria and categoria.descricao }}</textarea>
          <small class="form-hint">Máximo 200 caracteres</small>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <i class="fas {{ 'fa-save' if categoria else 'fa-plus-circle' }}"></i> 
            {{ 'Atualizar' if categoria else 'Criar' }}
          </button>
          <a href="{{ url_for('main.categorias_page') }}" class="btn btn-secondary">
            <i class="fas fa-times"></i> Cancelar
          </a>
        </div>
      </form>
    </section>

    <!-- Voltar -->
    <footer class="back-link animated-element">
      <a href="{{ url_for('main.categorias_page') }}">
        <i class="fas fa-arrow-left"></i> Voltar para lista
      </a>
    </footer>

  </main>

  <!-- Modal exclusão -->
  {% if categoria %}
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <h3 class="modal-title">Confirmar Exclusão</h3>
      <p>Tem certeza que deseja excluir <strong>"{{ categoria.nome }}"</strong>?</p>
      <p>Esta ação não pode ser desfeita.</p>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
        <form action="{{ url_for('main.delete_categoria', id=categoria.id) }}" method="POST">
          <button type="submit" class="btn btn-danger">Excluir</button>
        </form>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Script principal -->
  <script src="{{ url_for('static', filename='categoria_form.js') }}"></script>

  <!-- Script do tema -->
  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    // Recupera tema salvo
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      body.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);
    }

    // Alterna tema
    themeToggle.addEventListener('click', () => {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    });

    function updateThemeIcon(theme) {
      const icon = themeToggle.querySelector('i');
      if (theme === 'dark') {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
      } else {
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
      }
    }

    // Modal exclusão
    {% if categoria %}
    function confirmDelete() {
      document.getElementById('deleteModal').classList.add('active');
    }
    function closeModal() {
      document.getElementById('deleteModal').classList.remove('active');
    }
    document.getElementById('deleteModal')?.addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });
    {% endif %}
  </script>

</body>
</html>
