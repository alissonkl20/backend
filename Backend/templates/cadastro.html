<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5">
<title>Cria√ß√£o de Produto | Dashboard Neon</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='cadastro.css') }}">
<meta name="color-scheme" content="light dark">
</head>
<body data-theme="light">
<div class="glow-container animate__animated animate__fadeIn">
<div class="container">
<div class="header">
<h1 id="formTitle">Cadastro de Produto</h1>
</div>
<div class="form-container">
<form id="productForm">
<div class="form-group">
<label for="id">ID:</label>
<input type="number" id="id" name="id" class="form-control" placeholder=" " readonly>
<span class="floating-label">ID (autom√°tico)</span>
</div>
<div class="form-group">
<label for="nome">Nome do Produto:</label>
<input type="text" id="nome" name="nome" class="form-control" required placeholder=" ">
<span class="floating-label">Obrigat√≥rio</span>
</div>
<div class="form-group">
<label for="preco">Pre√ßo (R$):</label>
<input type="number" id="preco" name="preco" class="form-control" step="0.01" min="0" required placeholder=" " inputmode="decimal">
<span class="floating-label">Obrigat√≥rio</span>
</div>
<div class="form-group">
<label>Disponibilidade:</label>
<div class="checkbox-group">
<input type="checkbox" id="disponivel" name="disponivel" checked>
<label for="disponivel">Produto dispon√≠vel para venda</label>
</div>
</div>
<div class="form-group">
<label for="categoria">Categoria:</label>
<select id="categoria" name="categoria" class="form-control">
<option value="">Selecione uma categoria</option>
<option value="2">Doces</option>
<option value="3">Salgados</option>
<option value="4">P√£es</option>
<option value="5">Bolos</option>
<option value="6">Tortas</option>
<option value="7">Mousses</option>
</select>
<span class="floating-label">Opcional</span>
</div>
<div class="button-group">
<button type="button" class="btn" onclick="handleSubmit()" id="submitBtn">
<span id="buttonText">Cadastrar Produto</span>
</button>
<button type="button" class="btn" onclick="updateProductByName()" id="updateByNameBtn">
<span>Atualizar por Nome</span>
</button>
<button type="button" class="btn btn-danger" onclick="deleteProductByName()" id="deleteByNameBtn">
<span>Deletar por Nome</span>
</button>
</div>
</form>
<div id="message" class="message"></div>
<div class="output-container" hidden>
<h2>Dados Enviados:</h2>
<div id="jsonOutput">Preencha o formul√°rio para visualizar os dados que ser√£o enviados</div>
</div>
<div class="output-container">
<h2>Card√°pio por Categorias:</h2>
<div id="productCategoriesList"></div>
</div>
</div>
</div>
</div>
<button class="theme-toggle" id="themeToggle" aria-label="Alternar tema">
<i class="fas fa-moon"></i>
</button>
<script>
const API_BASE_URL = window.location.origin + '/api';const CATEGORIAS={2:"Doces",3:"Salgados",4:"P√£es",5:"Bolos",6:"Tortas",7:"Mousses"};document.addEventListener('DOMContentLoaded',function(){const e=new URLSearchParams(window.location.search);e.get('id')&&loadProduct(e.get('id')),loadProductCategories(),document.getElementById('productForm').addEventListener('submit',function(e){e.preventDefault(),handleSubmit()})});const themeToggle=document.getElementById('themeToggle'),prefersDarkScheme=window.matchMedia('(prefers-color-scheme: dark)'),currentTheme=localStorage.getItem('theme')||(prefersDarkScheme.matches?'dark':'light');document.body.setAttribute('data-theme',currentTheme),updateThemeIcon(currentTheme),themeToggle.addEventListener('click',()=>{const e=document.body.getAttribute('data-theme'),t='light'===e?'dark':'light';document.body.setAttribute('data-theme',t),localStorage.setItem('theme',t),updateThemeIcon(t),themeToggle.style.transform='scale(0.9)',setTimeout(()=>{themeToggle.style.transform='scale(1)'},100)}),prefersDarkScheme.addEventListener('change',e=>{localStorage.getItem('theme')||(document.body.setAttribute('data-theme',e.matches?'dark':'light'),updateThemeIcon(e.matches?'dark':'light'))});function updateThemeIcon(e){const t=themeToggle.querySelector('i');t.className='light'===e?'fas fa-moon':'fas fa-sun',t.setAttribute('aria-hidden','true')}document.querySelectorAll('.btn').forEach(e=>{e.addEventListener('click',function(t){if(!('ontouchstart'in window)){const e=this.getBoundingClientRect(),n=document.createElement('span');n.classList.add('ripple-effect'),n.style.left=`${t.clientX-e.left}px`,n.style.top=`${t.clientY-e.top}px`,this.appendChild(n),setTimeout(()=>{n.remove()},600)}})});async function loadProduct(e){try{const t=await fetch(`${API_BASE_URL}/produtos/${e}`,{headers:{'Content-Type':'application/json','Accept':'application/json'}});if(!t.ok)throw new Error(`Erro ao carregar produto: ${t.status}`);const n=await t.json();document.getElementById('id').value=n.id,document.getElementById('nome').value=n.nome,document.getElementById('preco').value=n.preco,document.getElementById('disponivel').checked=n.disponivel,document.getElementById('categoria').value=n.categoria?.id||'',document.getElementById('formTitle').textContent='Edi√ß√£o de Produto',document.getElementById('buttonText').textContent='Atualizar Produto',document.getElementById('id').readOnly=!0,document.getElementById('jsonOutput').textContent=JSON.stringify(n,null,2)}catch(e){showMessage(`‚úñ Erro ao carregar produto: ${e.message}`,!1),console.error('Erro detalhado:',e)}}async function loadProductCategories(){const e=document.getElementById('productCategoriesList');e.innerHTML='<div class="loading-state"><i class="fas fa-spinner fa-spin"></i> Carregando card√°pio...</div>';try{const t=await fetch(`${API_BASE_URL}/produtos`);if(!t.ok)throw new Error(`Erro ao carregar produtos: ${t.status}`);const n=await t.json();if(0===n.length)return void(e.innerHTML='<div class="no-products">Nenhum produto cadastrado ainda.</div>');const o={};n.forEach(e=>{const t=e.categoria?.id||'sem-categoria',n=CATEGORIAS[t]||'Outros';o[n]||(o[n]=[]),o[n].push(e)});const r=Object.keys(o).sort();e.innerHTML='',r.forEach(t=>{const n=document.createElement('div');n.className='category-container';const r=document.createElement('div');r.className='category-header',r.innerHTML=`${t}<i class="fas fa-chevron-down"></i>`;const a=document.createElement('ul');a.className='product-list',o[t].forEach(e=>{const t=document.createElement('li');t.className='product-item',t.innerHTML=`<span class="product-name">${e.nome}</span><span class="product-price">R$ ${e.preco.toFixed(2)}</span><span class="product-status ${e.disponivel?'status-available':'status-unavailable'}">${e.disponivel?'Dispon√≠vel':'Indispon√≠vel'}</span>`,a.appendChild(t)}),r.addEventListener('click',function(){this.classList.toggle('collapsed'),a.classList.toggle('collapsed')}),n.appendChild(r),n.appendChild(a),e.appendChild(n)})}catch(e){e.innerHTML='<div class="error-state"><i class="fas fa-exclamation-circle"></i> Erro ao carregar card√°pio</div>',console.error('Erro ao carregar produtos:',e)}}function showMessage(e,t){const n=document.getElementById('message');n.textContent=e,n.className=t?'message success':'message error',n.style.display='block',n.classList.add('animate__animated','animate__fadeIn'),setTimeout(()=>{n.style.display='none'},5e3)}function handleSubmit(){const e=document.getElementById('id').value;e?updateProduct(e):submitForm()}async function submitForm(){const e=document.getElementById('submitBtn');e.disabled=!0,e.innerHTML='<span>Enviando... ‚ú®</span>';try{const t={nome:document.getElementById('nome').value.trim(),preco:parseFloat(document.getElementById('preco').value),disponivel:document.getElementById('disponivel').checked,categoria:{id:document.getElementById('categoria').value.trim()?parseInt(document.getElementById('categoria').value.trim()):null}};if(!t.nome||t.nome.length<2)throw new Error('Nome do produto deve ter pelo menos 2 caracteres');if(isNaN(t.preco)||t.preco<=0)throw new Error('Pre√ßo deve ser um n√∫mero positivo');document.getElementById('jsonOutput').textContent=JSON.stringify(t,null,2);const n=await fetch(`${API_BASE_URL}/produtos`,{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify(t)});if(!n.ok){const errorText=await n.text();throw new Error(`Erro do servidor (${n.status}): ${errorText}`)}const o=await n.json();showMessage('‚úî Produto cadastrado com sucesso! ID: '+(o.id||'Novo'),!0),console.log('Resposta da API:',o),document.getElementById('productForm').reset(),document.querySelector('.glow-container').style.animation='glow 0.5s 3 alternate',loadProductCategories()}catch(e){showMessage(`‚úñ Falha ao cadastrar: ${e.message}`,!1),console.error('Erro detalhado:',e);const t=document.querySelector('.glow-container');t.style.boxShadow='0 0 20px rgba(255, 0, 106, 0.7)',setTimeout(()=>{t.style.boxShadow=''},1e3)}finally{e.disabled=!1,e.innerHTML='<span id="buttonText">Cadastrar Produto</span>'}}async function updateProduct(e){const t=document.getElementById('submitBtn');t.disabled=!0,t.innerHTML='<span>Atualizando... üîÑ</span>';try{const n={nome:document.getElementById('nome').value.trim(),preco:parseFloat(document.getElementById('preco').value),disponivel:document.getElementById('disponivel').checked,categoria:{id:document.getElementById('categoria').value.trim()?parseInt(document.getElementById('categoria').value.trim()):null}};if(!n.nome||n.nome.length<2)throw new Error('Nome do produto deve ter pelo menos 2 caracteres');if(isNaN(n.preco)||n.preco<=0)throw new Error('Pre√ßo deve ser um n√∫mero positivo');document.getElementById('jsonOutput').textContent=JSON.stringify(n,null,2);const o=await fetch(`${API_BASE_URL}/produtos/${e}`,{method:'PUT',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify(n)});if(!o.ok){const errorText=await o.text();throw new Error(`Erro do servidor (${o.status}): ${errorText}`)}const r=await o.json();showMessage('‚úî Produto atualizado com sucesso!',!0),console.log('Resposta da API:',r),document.querySelector('.glow-container').style.animation='glow 0.5s 3 alternate',loadProductCategories()}catch(e){showMessage(`‚úñ Falha ao atualizar: ${e.message}`,!1),console.error('Erro detalhado:',e);const n=document.querySelector('.glow-container');n.style.boxShadow='0 0 20px rgba(255, 0, 106, 0.7)',setTimeout(()=>{n.style.boxShadow=''},1e3)}finally{t.disabled=!1,t.innerHTML='<span id="buttonText">Atualizar Produto</span>'}}async function updateProductByName(){const e=document.getElementById('updateByNameBtn');e.disabled=!0,e.innerHTML='<span>Atualizando... üîÑ</span>';try{const t=document.getElementById('nome').value.trim(),n={nome:t,preco:parseFloat(document.getElementById('preco').value),disponivel:document.getElementById('disponivel').checked,categoria:{id:document.getElementById('categoria').value.trim()?parseInt(document.getElementById('categoria').value.trim()):null}};if(!n.nome||n.nome.length<2)throw new Error('Nome do produto deve ter pelo menos 2 caracteres');if(isNaN(n.preco)||n.preco<=0)throw new Error('Pre√ßo deve ser um n√∫mero positivo');document.getElementById('jsonOutput').textContent=JSON.stringify(n,null,2);const o=await fetch(`${API_BASE_URL}/produtos/nome/${encodeURIComponent(t)}`,{method:'PUT',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify(n)});if(!o.ok){const errorText=await o.text();throw new Error(`Erro do servidor (${o.status}): ${errorText}`)}const r=await o.json();showMessage('‚úî Produto atualizado pelo nome com sucesso!',!0),console.log('Resposta da API:',r),document.querySelector('.glow-container').style.animation='glow 0.5s 3 alternate',loadProductCategories()}catch(e){showMessage(`‚úñ Falha ao atualizar por nome: ${e.message}`,!1),console.error('Erro detalhado:',e);const t=document.querySelector('.glow-container');t.style.boxShadow='0 0 20px rgba(255, 0, 106, 0.7)',setTimeout(()=>{t.style.boxShadow=''},1e3)}finally{e.disabled=!1,e.innerHTML='<span>Atualizar por Nome</span>'}}async function deleteProductByName(){const e=document.getElementById('deleteByNameBtn');e.disabled=!0,e.innerHTML='<span>Deletando... üóëÔ∏è</span>';try{const t=document.getElementById('nome').value.trim();if(!t)throw new Error('Informe o nome do produto para deletar.');if(!confirm(`Tem certeza que deseja excluir o produto "${t}"?`))return void(e.disabled=!1,e.innerHTML='<span>Deletar por Nome</span>');const n=await fetch(`${API_BASE_URL}/produtos/${encodeURIComponent(t)}`,{method:'DELETE',headers:{'Content-Type':'application/json','Accept':'application/json'}});if(!n.ok){const errorText=await n.text();throw new Error(`Erro do servidor (${n.status}): ${errorText}`)}showMessage('‚úî Produto deletado pelo nome com sucesso!',!0),document.getElementById('productForm').reset(),loadProductCategories(),document.querySelector('.glow-container').style.animation='glow 0.5s 3 alternate'}catch(e){showMessage(`‚úñ Falha ao deletar por nome: ${e.message}`,!1),console.error('Erro detalhado:',e);const t=document.querySelector('.glow-container');t.style.boxShadow='0 0 20px rgba(255, 0, 106, 0.7)',setTimeout(()=>{t.style.boxShadow=''},1e3)}finally{e.disabled=!1,e.innerHTML='<span>Deletar por Nome</span>'}}
</script>
</body>
</html>